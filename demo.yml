wf1:
  name: "myworkflow"
  meta:
    owner: Sadayuki Furuhashi
    created_at: "2015-09-11"

  params:
    td_production:
      apikey: ...
      database: ...

  default:
    error:
      sh>: "echo email body: $error_task_name failed. Will be rtried at $error_retry_at. Message: $error_message"

  +simple_grouping:
    +load:
      sh>: echo "embulk..."
    +analyze:
      parallel: true
      +make_pv:
        sh>: echo "CREATE TABLE pv AS SELECT ..."
        <use: td_production
      +make_users:
        sh>: echo "CREATE TABLE users AS SELECT ..."
        <use: td_production
      +make_joined:
        after: [+make_pv, +make_users]
        sh>: echo "CREATE TABLE joined AS SELECT ..."
        <use: td_production
    +dump:
      sh>: echo "select * from joined"
      <use: td_production

  +subtask_example:
    +split:
      py>: tasks.SplitFiles
      count: 3
      check:
        py>: tasks.CheckFiles
    +print:
      py>: tasks.PrintFiles

  +report:
    sh>: echo "done"

