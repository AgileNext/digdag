

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Operators &mdash; Digdag 0.8 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Digdag 0.8 documentation" href="index.html"/>
        <link rel="next" title="Command reference" href="command_reference.html"/>
        <link rel="prev" title="Scheduling workflow" href="scheduling_workflow.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Digdag
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow_definition.html">Workflow definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling_workflow.html">Scheduling workflow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Operators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#call-calls-another-workflow">call&gt;: Calls another workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#require-depends-on-another-workflow">require&gt;: Depends on another workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#py-python-scripts">py&gt;: Python scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rb-ruby-scripts">rb&gt;: Ruby scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sh-shell-scripts">sh&gt;: Shell scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loop-repeat-tasks">loop&gt;: Repeat tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-each-repeat-tasks">for_each&gt;: Repeat tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#if-conditional-execution">if&gt;: Conditional execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fail-make-the-workflow-failed">fail&gt;: make the workflow failed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#td-treasure-data-queries">td&gt;: Treasure Data queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#secrets">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-parameters">Output parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#td-run-treasure-data-saved-queries">td_run&gt;: Treasure Data saved queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Output parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#td-load-treasure-data-bulk-loading">td_load&gt;: Treasure Data bulk loading</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Output parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#td-ddl-treasure-data-operations">td_ddl&gt;: Treasure Data operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#td-table-export-treasure-data-table-export-to-s3">td_table_export&gt;: Treasure Data table export to S3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Output parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pg-postgresql-operations">pg&gt;: PostgreSQL operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mail-sending-email">mail&gt;: Sending email</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#embulk-embulk-data-transfer">embulk&gt;: Embulk data transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#s3-wait-wait-for-a-file-in-amazon-s3">s3_wait&gt;: Wait for a file in Amazon S3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Output Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bq-running-google-bigquery-queries">bq&gt;: Running Google BigQuery queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id19">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">Output parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bq-ddl-managing-google-bigquery-datasets-and-tables">bq_ddl&gt;: Managing Google BigQuery Datasets and Tables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bq-extract-exporting-data-from-google-bigquery">bq_extract&gt;: Exporting Data from Google BigQuery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id27">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">Output parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bq-load-importing-data-into-google-bigquery">bq_load&gt;: Importing Data into Google BigQuery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id30">Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">Output parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_reference.html">Command reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_api.html">Language API - Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="ruby_api.html">Language API - Ruby</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal.html">Internal architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Digdag</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Operators</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/operators.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="operators">
<h1>Operators<a class="headerlink" href="#operators" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#call-calls-another-workflow" id="id33">call&gt;: Calls another workflow</a></li>
<li><a class="reference internal" href="#require-depends-on-another-workflow" id="id34">require&gt;: Depends on another workflow</a></li>
<li><a class="reference internal" href="#py-python-scripts" id="id35">py&gt;: Python scripts</a></li>
<li><a class="reference internal" href="#rb-ruby-scripts" id="id36">rb&gt;: Ruby scripts</a></li>
<li><a class="reference internal" href="#sh-shell-scripts" id="id37">sh&gt;: Shell scripts</a></li>
<li><a class="reference internal" href="#loop-repeat-tasks" id="id38">loop&gt;: Repeat tasks</a></li>
<li><a class="reference internal" href="#for-each-repeat-tasks" id="id39">for_each&gt;: Repeat tasks</a></li>
<li><a class="reference internal" href="#if-conditional-execution" id="id40">if&gt;: Conditional execution</a></li>
<li><a class="reference internal" href="#fail-make-the-workflow-failed" id="id41">fail&gt;: make the workflow failed</a></li>
<li><a class="reference internal" href="#td-treasure-data-queries" id="id42">td&gt;: Treasure Data queries</a><ul>
<li><a class="reference internal" href="#secrets" id="id43">Secrets</a></li>
<li><a class="reference internal" href="#parameters" id="id44">Parameters</a></li>
<li><a class="reference internal" href="#output-parameters" id="id45">Output parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#td-run-treasure-data-saved-queries" id="id46">td_run&gt;: Treasure Data saved queries</a><ul>
<li><a class="reference internal" href="#id1" id="id47">Secrets</a></li>
<li><a class="reference internal" href="#id2" id="id48">Parameters</a></li>
<li><a class="reference internal" href="#id3" id="id49">Output parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#td-load-treasure-data-bulk-loading" id="id50">td_load&gt;: Treasure Data bulk loading</a><ul>
<li><a class="reference internal" href="#id4" id="id51">Secrets</a></li>
<li><a class="reference internal" href="#id5" id="id52">Parameters</a></li>
<li><a class="reference internal" href="#id6" id="id53">Output parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#td-ddl-treasure-data-operations" id="id54">td_ddl&gt;: Treasure Data operations</a><ul>
<li><a class="reference internal" href="#id7" id="id55">Secrets</a></li>
<li><a class="reference internal" href="#id8" id="id56">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#td-table-export-treasure-data-table-export-to-s3" id="id57">td_table_export&gt;: Treasure Data table export to S3</a><ul>
<li><a class="reference internal" href="#id9" id="id58">Secrets</a></li>
<li><a class="reference internal" href="#id10" id="id59">Parameters</a></li>
<li><a class="reference internal" href="#id11" id="id60">Output parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pg-postgresql-operations" id="id61">pg&gt;: PostgreSQL operations</a><ul>
<li><a class="reference internal" href="#id12" id="id62">Secrets</a></li>
<li><a class="reference internal" href="#id13" id="id63">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mail-sending-email" id="id64">mail&gt;: Sending email</a><ul>
<li><a class="reference internal" href="#id14" id="id65">Secrets</a></li>
<li><a class="reference internal" href="#id15" id="id66">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#embulk-embulk-data-transfer" id="id67">embulk&gt;: Embulk data transfer</a></li>
<li><a class="reference internal" href="#s3-wait-wait-for-a-file-in-amazon-s3" id="id68">s3_wait&gt;: Wait for a file in Amazon S3</a><ul>
<li><a class="reference internal" href="#id16" id="id69">Secrets</a></li>
<li><a class="reference internal" href="#id17" id="id70">Parameters</a></li>
<li><a class="reference internal" href="#id18" id="id71">Output Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bq-running-google-bigquery-queries" id="id72">bq&gt;: Running Google BigQuery queries</a><ul>
<li><a class="reference internal" href="#id19" id="id73">Secrets</a></li>
<li><a class="reference internal" href="#id20" id="id74">Parameters</a></li>
<li><a class="reference internal" href="#id22" id="id75">Output parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bq-ddl-managing-google-bigquery-datasets-and-tables" id="id76">bq_ddl&gt;: Managing Google BigQuery Datasets and Tables</a><ul>
<li><a class="reference internal" href="#id23" id="id77">Secrets</a></li>
<li><a class="reference internal" href="#id24" id="id78">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bq-extract-exporting-data-from-google-bigquery" id="id79">bq_extract&gt;: Exporting Data from Google BigQuery</a><ul>
<li><a class="reference internal" href="#id27" id="id80">Secrets</a></li>
<li><a class="reference internal" href="#id28" id="id81">Parameters</a></li>
<li><a class="reference internal" href="#id29" id="id82">Output parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bq-load-importing-data-into-google-bigquery" id="id83">bq_load&gt;: Importing Data into Google BigQuery</a><ul>
<li><a class="reference internal" href="#id30" id="id84">Secrets</a></li>
<li><a class="reference internal" href="#id31" id="id85">Parameters</a></li>
<li><a class="reference internal" href="#id32" id="id86">Output parameters</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="call-calls-another-workflow">
<h2><a class="toc-backref" href="#id33">call&gt;: Calls another workflow</a><a class="headerlink" href="#call-calls-another-workflow" title="Permalink to this headline">¶</a></h2>
<p><strong>call&gt;:</strong> operator calls another workflow.</p>
<p>This operator embeds another workflow as a subtask.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># workflow1.dig</span>
<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">call&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">another_workflow.dig</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">call&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">common/shared_workflow.dig</span>
</pre></div>
</div>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># another_workflow.dig</span>
<span class="l l-Scalar l-Scalar-Plain">+another</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">../scripts/my_script.sh</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">call&gt;: FILE</strong></dt>
<dd><p class="first">Path to a workflow definition file. File name must end with <code class="docutils literal"><span class="pre">.dig</span></code>.
If called workflow is in a subdirectory, the workflow uses the subdirectory as the working directory. For example, a task has <code class="docutils literal"><span class="pre">call&gt;:</span> <span class="pre">common/called_workflow.dig</span></code>, using <code class="docutils literal"><span class="pre">queries/data.sql</span></code> file in the called workflow should be <code class="docutils literal"><span class="pre">../queries/data.sql</span></code>.</p>
<p class="last">Example: another_workflow.dig</p>
</dd>
</dl>
</div>
<div class="section" id="require-depends-on-another-workflow">
<h2><a class="toc-backref" href="#id34">require&gt;: Depends on another workflow</a><a class="headerlink" href="#require-depends-on-another-workflow" title="Permalink to this headline">¶</a></h2>
<p><strong>require&gt;:</strong> operator runs another workflow. Unlike <code class="docutils literal"><span class="pre">call&gt;</span></code> operator, the workflow is skipped if the workflow for the session time is already done successfully before.</p>
<p>This operator submits a new session to digdag.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># workflow1.dig</span>
<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">require&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">another_workflow</span>
</pre></div>
</div>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># another_workflow.dig</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tasks/step2.sh</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">require&gt;: NAME</strong></dt>
<dd><p class="first">Name of a workflow.</p>
<p class="last">Example: another_workflow</p>
</dd>
</dl>
</div>
<div class="section" id="py-python-scripts">
<h2><a class="toc-backref" href="#id35">py&gt;: Python scripts</a><a class="headerlink" href="#py-python-scripts" title="Permalink to this headline">¶</a></h2>
<p><strong>py&gt;:</strong> operator runs a Python script using <code class="docutils literal"><span class="pre">python</span></code> command.</p>
<p>See <a class="reference external" href="python_api.html">Python API documents</a> for details including variable mappings to keyword arguments.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">py&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_step1_method</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">py&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tasks.MyWorkflow.step2</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">py&gt;: [PACKAGE.CLASS.]METHOD</strong></dt>
<dd><p class="first">Name of a method to run.</p>
<ul class="last simple">
<li><strong class="command">py&gt;: tasks.MyWorkflow.my_task</strong></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="rb-ruby-scripts">
<h2><a class="toc-backref" href="#id36">rb&gt;: Ruby scripts</a><a class="headerlink" href="#rb-ruby-scripts" title="Permalink to this headline">¶</a></h2>
<p><strong>rb&gt;:</strong> operator runs a Ruby script using <code class="docutils literal"><span class="pre">ruby</span></code> command.</p>
<p>See <a class="reference external" href="ruby_api.html">Ruby API documents</a> for details including best practices how to configure the workflow using <code class="docutils literal"><span class="pre">_export:</span> <span class="pre">require:</span></code>.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rb</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">require</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tasks/my_workflow</span>

<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rb&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_step1_method</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rb&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Task::MyWorkflow.step2</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">rb&gt;: [MODULE::CLASS.]METHOD</strong></dt>
<dd><p class="first">Name of a method to run.</p>
<ul class="last simple">
<li><strong class="command">rb&gt;: Task::MyWorkflow.my_task</strong></li>
</ul>
</dd>
<dt><strong class="command">require: FILE</strong></dt>
<dd><p class="first">Name of a file to require.</p>
<ul class="last simple">
<li><strong class="command">require: task/my_workflow</strong></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="sh-shell-scripts">
<h2><a class="toc-backref" href="#id37">sh&gt;: Shell scripts</a><a class="headerlink" href="#sh-shell-scripts" title="Permalink to this headline">¶</a></h2>
<p><strong>sh&gt;:</strong> operator runs a shell script.</p>
<p>Run a shell command (<cite>/bin/sh</cite>)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &quot;hello world&quot;</span>
</pre></div>
</div>
<p>Run a shell script</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tasks/step1.sh</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tasks/step2.sh</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">sh&gt;: COMMAND [ARGS...]</strong></dt>
<dd><p class="first">Name of the command to run.</p>
<ul class="last simple">
<li><strong class="command">sh&gt;: tasks/workflow.sh --task1</strong></li>
</ul>
</dd>
</dl>
<p>The shell defaults to <cite>/bin/sh</cite>. If an alternate shell such as <cite>zsh</cite> is desired, use the <cite>shell</cite> option in the <cite>_export</cite> section.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sh</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">/usr/bin/zsh</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="loop-repeat-tasks">
<h2><a class="toc-backref" href="#id38">loop&gt;: Repeat tasks</a><a class="headerlink" href="#loop-repeat-tasks" title="Permalink to this headline">¶</a></h2>
<p><strong>loop&gt;:</strong> operator runs subtasks multiple times.</p>
<p>This operator exports <code class="docutils literal"><span class="pre">${i}</span></code> variable for the subtasks. Its value begins from 0. For example, if count is 3, a task runs with i=0, i=1, and i=2.</p>
<p>(This operator is EXPERIMENTAL. Parameters may change in a future release)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+repeat</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">loop&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7</span>
  <span class="l l-Scalar l-Scalar-Plain">_do</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo ${new Date((session_unixtime + i * 60 * 60 * 24) * 1000).toLocaleDateString()} is ${i} days later than $session_date</span>
    <span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo ${</span>
            <span class="l l-Scalar l-Scalar-Plain">new Date((session_unixtime + i * 60 * 60) * 1000).toLocaleDateString()</span>
            <span class="l l-Scalar l-Scalar-Plain">+ &quot; &quot;</span>
            <span class="l l-Scalar l-Scalar-Plain">+ new Date((session_unixtime + i * 60 * 60) * 1000).toLocaleTimeString()</span>
        <span class="l l-Scalar l-Scalar-Plain">} is ${i} hours later than ${session_local_time}</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">loop&gt;: COUNT</strong></dt>
<dd><p class="first">Number of times to run the tasks.</p>
<ul class="last simple">
<li><strong class="command">loop&gt;: 7</strong></li>
</ul>
</dd>
<dt><strong class="command">_parallel: BOOLEAN</strong></dt>
<dd><p class="first">Runs the repeating tasks in parallel.</p>
<ul class="last simple">
<li><strong class="command">_parallel: true</strong></li>
</ul>
</dd>
<dt><strong class="command">_do: TASKS</strong></dt>
<dd>Tasks to run.</dd>
</dl>
</div>
<div class="section" id="for-each-repeat-tasks">
<h2><a class="toc-backref" href="#id39">for_each&gt;: Repeat tasks</a><a class="headerlink" href="#for-each-repeat-tasks" title="Permalink to this headline">¶</a></h2>
<p><strong>for_each&gt;:</strong> operator runs subtasks multiple times using sets of variables.</p>
<p>(This operator is EXPERIMENTAL. Parameters may change in a future release)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+repeat</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">for_each&gt;</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">fruit</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">apple</span><span class="p p-Indicator">,</span> <span class="nv">orange</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">verb</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">eat</span><span class="p p-Indicator">,</span> <span class="nv">throw</span><span class="p p-Indicator">]</span>
  <span class="l l-Scalar l-Scalar-Plain">_do</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo ${verb} ${fruit}</span>
    <span class="c1"># this will generate 4 tasks:</span>
    <span class="c1">#  +for-fruit=apple&amp;verb=eat:</span>
    <span class="c1">#    sh&gt;: echo eat apple</span>
    <span class="c1">#  +for-fruit=apple&amp;verb=throw:</span>
    <span class="c1">#    sh&gt;: echo throw apple</span>
    <span class="c1">#  +for-fruit=orange&amp;verb=eat:</span>
    <span class="c1">#    sh&gt;: echo eat orange</span>
    <span class="c1">#  +for-fruit=orange&amp;verb=throw:</span>
    <span class="c1">#    sh&gt;: echo throw orange</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">for_each&gt;: VARIABLES</strong></dt>
<dd><p class="first">Variables used for the loop in <code class="docutils literal"><span class="pre">key:</span> <span class="pre">[value,</span> <span class="pre">value,</span> <span class="pre">...]</span></code> syntax. Variables can be an object or JSON string.</p>
<ul class="last simple">
<li><strong class="command">for_each&gt;: {i: [1, 2, 3]}</strong></li>
<li>or <strong class="command">for_each&gt;: {i: '[1, 2, 3]'}</strong></li>
</ul>
</dd>
<dt><strong class="command">_parallel: BOOLEAN</strong></dt>
<dd><p class="first">Runs the repeating tasks in parallel.</p>
<ul class="last simple">
<li><strong class="command">_parallel: true</strong></li>
</ul>
</dd>
<dt><strong class="command">_do: TASKS</strong></dt>
<dd>Tasks to run.</dd>
</dl>
</div>
<div class="section" id="if-conditional-execution">
<h2><a class="toc-backref" href="#id40">if&gt;: Conditional execution</a><a class="headerlink" href="#if-conditional-execution" title="Permalink to this headline">¶</a></h2>
<p><strong>if&gt;:</strong> operator runs subtasks if <code class="docutils literal"><span class="pre">true</span></code> is given.</p>
<p>(This operator is EXPERIMENTAL. Parameters may change in a future release)</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+run_if_param_is_true</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">if&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">${param}</span>
  <span class="l l-Scalar l-Scalar-Plain">_do</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo ${param} == true</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">if&gt;: BOOLEAN</strong></dt>
<dd><code class="docutils literal"><span class="pre">true</span></code> or <code class="docutils literal"><span class="pre">false</span></code>.</dd>
<dt><strong class="command">_do: TASKS</strong></dt>
<dd>Tasks to run if <code class="docutils literal"><span class="pre">true</span></code> is given.</dd>
</dl>
</div>
<div class="section" id="fail-make-the-workflow-failed">
<h2><a class="toc-backref" href="#id41">fail&gt;: make the workflow failed</a><a class="headerlink" href="#fail-make-the-workflow-failed" title="Permalink to this headline">¶</a></h2>
<p><strong>fail&gt;:</strong> always fails and makes the workflow failed.</p>
<p>(This operator is EXPERIMENTAL. Parameters may change in a future release)</p>
<p>This operator is useful used with <strong>if&gt;</strong> operator to validate resuls of a previous task with <code class="docutils literal"><span class="pre">_check</span></code> directive so that a workflow fails when the validation doesn&#8217;t pass.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+fail_if_too_few</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">if&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">${count &lt; 10}</span>
  <span class="l l-Scalar l-Scalar-Plain">_do</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">fail&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">count is less than 10!</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">fail&gt;: STRING</strong></dt>
<dd>Message so that <code class="docutils literal"><span class="pre">_error</span></code> task can refer the message using <code class="docutils literal"><span class="pre">${error.message}</span></code> syntax.</dd>
</dl>
</div>
<div class="section" id="td-treasure-data-queries">
<h2><a class="toc-backref" href="#id42">td&gt;: Treasure Data queries</a><a class="headerlink" href="#td-treasure-data-queries" title="Permalink to this headline">¶</a></h2>
<p><strong>td&gt;:</strong> operator runs a Hive or Presto query on Treasure Data.</p>
<p>TODO: add more description here</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">database</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">www_access</span>

<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/step1.sql</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/step2.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">create_table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mytable_${session_date_compact}</span>
<span class="l l-Scalar l-Scalar-Plain">+step3</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/step2.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">insert_into</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mytable</span>
</pre></div>
</div>
<div class="section" id="secrets">
<h3><a class="toc-backref" href="#id43">Secrets</a><a class="headerlink" href="#secrets" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.apikey: API_KEY</strong></dt>
<dd>The Treasure Data API key to use when running Treasure Data queries.</dd>
</dl>
</div>
<div class="section" id="parameters">
<h3><a class="toc-backref" href="#id44">Parameters</a><a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td&gt;: FILE.sql</strong></dt>
<dd><p class="first">Path to a query template file. This file can contain <code class="docutils literal"><span class="pre">${...}</span></code> syntax to embed variables.</p>
<ul class="last simple">
<li><strong class="command">td&gt;: queries/step1.sql</strong></li>
</ul>
</dd>
<dt><strong class="command">create_table: NAME</strong></dt>
<dd><p class="first">Name of a table to create from the results. This option deletes the table if it already exists.</p>
<p>This option adds DROP TABLE IF EXISTS; CREATE TABLE AS (Presto) or INSERT OVERWRITE (Hive) commands before the SELECT statement. If the query includes a <code class="docutils literal"><span class="pre">--</span> <span class="pre">DIGDAG_INSERT_LINE</span></code> line, the commands are inserted there.</p>
<ul class="last simple">
<li><strong class="command">create_table: my_table</strong></li>
</ul>
</dd>
<dt><strong class="command">insert_into: NAME</strong></dt>
<dd><p class="first">Name of a table to append results into. The table is created if it does not already exist.</p>
<p>This option adds INSERT INTO (Presto) or INSERT INTO TABLE (Hive) command at the beginning of SELECT statement. If the query includes <code class="docutils literal"><span class="pre">--</span> <span class="pre">DIGDAG_INSERT_LINE</span></code> line, the command is inserted to the line.</p>
<ul class="last simple">
<li><strong class="command">insert_into: my_table</strong></li>
</ul>
</dd>
<dt><strong class="command">download_file: NAME</strong></dt>
<dd><p class="first">Saves query result as a local CSV file.</p>
<ul class="last simple">
<li><strong class="command">download_file: output.csv</strong></li>
</ul>
</dd>
<dt><strong class="command">store_last_results: BOOLEAN</strong></dt>
<dd><p class="first">Stores the first 1 row of the query results to <code class="docutils literal"><span class="pre">${td.last_results}</span></code> variable (default: false).
td.last_results is a map of column name and a value. To access to a single value, you can use <code class="docutils literal"><span class="pre">${td.last_results.my_count}</span></code> syntax.</p>
<ul class="last simple">
<li><strong class="command">store_last_results: true</strong></li>
</ul>
</dd>
<dt><strong class="command">preview: BOOLEAN</strong></dt>
<dd><p class="first">Tries to show some query results to confirm the results of a query.</p>
<ul class="last simple">
<li><strong class="command">preview: true</strong></li>
</ul>
</dd>
<dt><strong class="command">result_url: NAME</strong></dt>
<dd><p class="first">Output the query results to the URL:</p>
<ul class="last simple">
<li><strong class="command">result_url: tableau://username:password&#64;my.tableauserver.com/?mode=replace</strong></li>
</ul>
</dd>
<dt><strong class="command">database: NAME</strong></dt>
<dd><p class="first">Name of a database.</p>
<ul class="last simple">
<li><strong class="command">database: my_db</strong></li>
</ul>
</dd>
<dt><strong class="command">endpoint: ADDRESS</strong></dt>
<dd>API endpoint (default: api.treasuredata.com).</dd>
<dt><strong class="command">use_ssl: BOOLEAN</strong></dt>
<dd>Enable SSL (https) to access to the endpoint (default: true).</dd>
<dt><strong class="command">engine: presto</strong></dt>
<dd><p class="first">Query engine (<code class="docutils literal"><span class="pre">presto</span></code> or <code class="docutils literal"><span class="pre">hive</span></code>).</p>
<ul class="last simple">
<li><strong class="command">engine: hive</strong></li>
<li><strong class="command">engine: presto</strong></li>
</ul>
</dd>
<dt><strong class="command">priority: 0</strong></dt>
<dd>Set Priority (From <code class="docutils literal"><span class="pre">-2</span></code> (VERY LOW) to <code class="docutils literal"><span class="pre">2</span></code> (VERY HIGH) , default: 0 (NORMAL)).</dd>
</dl>
</div>
<div class="section" id="output-parameters">
<h3><a class="toc-backref" href="#id45">Output parameters</a><a class="headerlink" href="#output-parameters" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.last_job_id</strong></dt>
<dd><p class="first">The job id this task executed.</p>
<ul class="last simple">
<li><strong class="command">52036074</strong></li>
</ul>
</dd>
<dt><strong class="command">td.last_results</strong></dt>
<dd><p class="first">The first 1 row of the query results as a map. This is available only when <code class="docutils literal"><span class="pre">store_last_results:</span> <span class="pre">true</span></code> is set.</p>
<ul class="last simple">
<li><strong class="command">{&quot;path&quot;:&quot;/index.html&quot;,&quot;count&quot;:1}</strong></li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="td-run-treasure-data-saved-queries">
<h2><a class="toc-backref" href="#id46">td_run&gt;: Treasure Data saved queries</a><a class="headerlink" href="#td-run-treasure-data-saved-queries" title="Permalink to this headline">¶</a></h2>
<p><strong>td_run&gt;:</strong> operator runs a query saved on Treasure Data.</p>
<p>TODO: add more description here</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">database</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">www_access</span>

<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td_run&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">myquery1</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td_run&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">myquery2</span>
  <span class="l l-Scalar l-Scalar-Plain">session_time</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2016-01-01T01:01:01+0000</span>
</pre></div>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id47">Secrets</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.apikey: API_KEY</strong></dt>
<dd>The Treasure Data API key to use when running Treasure Data queries.</dd>
</dl>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id48">Parameters</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td_run&gt;: NAME</strong></dt>
<dd><p class="first">Name of a saved query.</p>
<ul class="last simple">
<li><strong class="command">td_run&gt;: my_query</strong></li>
</ul>
</dd>
<dt><strong class="command">download_file: NAME</strong></dt>
<dd><p class="first">Saves query result as a local CSV file.</p>
<ul class="last simple">
<li><strong class="command">download_file: output.csv</strong></li>
</ul>
</dd>
<dt><strong class="command">store_last_results: BOOLEAN</strong></dt>
<dd><p class="first">Stores the first 1 row of the query results to <code class="docutils literal"><span class="pre">${td.last_results}</span></code> variable (default: false).
td.last_results is a map of column name and a value. To access to a single value, you can use <code class="docutils literal"><span class="pre">${td.last_results.my_count}</span></code> syntax.</p>
<ul class="last simple">
<li><strong class="command">store_last_results: true</strong></li>
</ul>
</dd>
<dt><strong class="command">preview: BOOLEAN</strong></dt>
<dd><p class="first">Tries to show some query results to confirm the results of a query.</p>
<ul class="last simple">
<li><strong class="command">preview: true</strong></li>
</ul>
</dd>
<dt><strong class="command">endpoint: ADDRESS</strong></dt>
<dd>API endpoint (default: api.treasuredata.com).</dd>
<dt><strong class="command">use_ssl: BOOLEAN</strong></dt>
<dd>Enable SSL (https) to access to the endpoint (default: true).</dd>
</dl>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id49">Output parameters</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.last_job_id</strong></dt>
<dd><p class="first">The job id this task executed.</p>
<ul class="last simple">
<li><strong class="command">52036074</strong></li>
</ul>
</dd>
<dt><strong class="command">td.last_results</strong></dt>
<dd><p class="first">The first 1 row of the query results as a map. This is available only when <code class="docutils literal"><span class="pre">store_last_results:</span> <span class="pre">true</span></code> is set.</p>
<ul class="last simple">
<li><strong class="command">{&quot;path&quot;:&quot;/index.html&quot;,&quot;count&quot;:1}</strong></li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="td-load-treasure-data-bulk-loading">
<h2><a class="toc-backref" href="#id50">td_load&gt;: Treasure Data bulk loading</a><a class="headerlink" href="#td-load-treasure-data-bulk-loading" title="Permalink to this headline">¶</a></h2>
<p><strong>td_load&gt;:</strong> operator loads data from storages, databases, or services.</p>
<p>TODO: add more description here</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td_load&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">config/guessed.dig</span>
  <span class="l l-Scalar l-Scalar-Plain">database</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prod</span>
  <span class="l l-Scalar l-Scalar-Plain">table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">raw</span>
</pre></div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id51">Secrets</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.apikey: API_KEY</strong></dt>
<dd>The Treasure Data API key to use when submitting Treasure Data bulk load jobs.</dd>
</dl>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id52">Parameters</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td_load&gt;: FILE.yml</strong></dt>
<dd><p class="first">Path to a YAML template file. This configuration needs to be guessed using td command.</p>
<ul class="last simple">
<li><strong class="command">td_load&gt;: imports/load.yml</strong></li>
</ul>
</dd>
<dt><strong class="command">database: NAME</strong></dt>
<dd><p class="first">Name of the database load data to.</p>
<ul class="last simple">
<li><strong class="command">database: my_database</strong></li>
</ul>
</dd>
<dt><strong class="command">table: NAME</strong></dt>
<dd><p class="first">Name of the table load data to.</p>
<ul class="last simple">
<li><strong class="command">table: my_table</strong></li>
</ul>
</dd>
<dt><strong class="command">endpoint: ADDRESS</strong></dt>
<dd>API endpoint (default: api.treasuredata.com).</dd>
<dt><strong class="command">use_ssl: BOOLEAN</strong></dt>
<dd>Enable SSL (https) to access to the endpoint (default: true).</dd>
</dl>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id53">Output parameters</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.last_job_id</strong></dt>
<dd><p class="first">The job id this task executed.</p>
<ul class="last simple">
<li><strong class="command">52036074</strong></li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="td-ddl-treasure-data-operations">
<h2><a class="toc-backref" href="#id54">td_ddl&gt;: Treasure Data operations</a><a class="headerlink" href="#td-ddl-treasure-data-operations" title="Permalink to this headline">¶</a></h2>
<p><strong>td_ddl&gt;</strong> operator runs an operational task on Treasure Data.</p>
<p>TODO: add more description here</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">database</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">www_access</span>

<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td_ddl&gt;</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">create_tables</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;my_table_${session_date_compact}&quot;</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td_ddl&gt;</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">drop_tables</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;my_table_${session_date_compact}&quot;</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td_ddl&gt;</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">empty_tables</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;my_table_${session_date_compact}&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id55">Secrets</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.apikey: API_KEY</strong></dt>
<dd>The Treasure Data API key to use when performing Treasure Data operations.</dd>
</dl>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id56">Parameters</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">create_tables: [ARRAY OF NAMES]</strong></dt>
<dd><p class="first">Create new tables if not exists.</p>
<ul class="last simple">
<li><strong class="command">create_tables: [my_table1, my_table2]</strong></li>
</ul>
</dd>
<dt><strong class="command">empty_tables: [ARRAY OF NAME]</strong></dt>
<dd><p class="first">Create new tables (drop it first if it exists).</p>
<ul class="last simple">
<li><strong class="command">empty_tables: [my_table1, my_table2]</strong></li>
</ul>
</dd>
<dt><strong class="command">drop_tables: [ARRAY OF NAMES]</strong></dt>
<dd><p class="first">Drop tables if exists.</p>
<ul class="last simple">
<li><strong class="command">drop_tables: [my_table1, my_table2]</strong></li>
</ul>
</dd>
<dt><strong class="command">create_databases: [ARRAY OF NAMES]</strong></dt>
<dd><p class="first">Create new databases if not exists.</p>
<ul class="last simple">
<li><strong class="command">create_databases: [my_database1, my_database2]</strong></li>
</ul>
</dd>
<dt><strong class="command">empty_databases: [ARRAY OF NAME]</strong></dt>
<dd><p class="first">Create new databases (drop it first if it exists).</p>
<ul class="last simple">
<li><strong class="command">empty_databases: [my_database1, my_database2]</strong></li>
</ul>
</dd>
<dt><strong class="command">drop_databases: [ARRAY OF NAMES]</strong></dt>
<dd><p class="first">Drop databases if exists.</p>
<ul class="last simple">
<li><strong class="command">drop_databases: [my_database1, my_database2]</strong></li>
</ul>
</dd>
<dt><strong class="command">endpoint: ADDRESS</strong></dt>
<dd>API endpoint (default: api.treasuredata.com).</dd>
<dt><strong class="command">use_ssl: BOOLEAN</strong></dt>
<dd>Enable SSL (https) to access to the endpoint (default: true).</dd>
</dl>
</div>
</div>
<div class="section" id="td-table-export-treasure-data-table-export-to-s3">
<h2><a class="toc-backref" href="#id57">td_table_export&gt;: Treasure Data table export to S3</a><a class="headerlink" href="#td-table-export-treasure-data-table-export-to-s3" title="Permalink to this headline">¶</a></h2>
<p><strong>td_table_export&gt;:</strong> operator loads data from storages, databases, or services.</p>
<p>TODO: add more description here</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td_table_export&gt;</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">database</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
  <span class="l l-Scalar l-Scalar-Plain">table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mytable</span>
  <span class="l l-Scalar l-Scalar-Plain">file_format</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jsonl.gz</span>
  <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2016-01-01 00:00:00 +0800</span>
  <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span>   <span class="l l-Scalar l-Scalar-Plain">2016-02-01 00:00:00 +0800</span>
  <span class="l l-Scalar l-Scalar-Plain">s3_bucket</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_backup_backet</span>
  <span class="l l-Scalar l-Scalar-Plain">s3_path_prefix</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb/mytable</span>
</pre></div>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id58">Secrets</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.apikey: API_KEY</strong></dt>
<dd>The Treasure Data API key to use when running Treasure Data table exports.</dd>
<dt><strong class="command">aws.s3.access-key-id: ACCESS_KEY_ID</strong></dt>
<dd><p class="first">The AWS Access Key ID to use when writing to S3.</p>
<ul class="last simple">
<li><strong class="command">aws.s3.access-key-id: ABCDEFGHJKLMNOPQRSTU</strong></li>
</ul>
</dd>
<dt><strong class="command">aws.s3.secret-access-key: SECRET_ACCESS_KEY</strong></dt>
<dd><p class="first">The AWS Secret Access Key to use when writing to S3.</p>
<ul class="last simple">
<li><strong class="command">aws.s3.secret-access-key: QUtJ/QUpJWTQ3UkhZTERNUExTUEEQUtJQUpJWTQ3</strong></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id59">Parameters</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">database: NAME</strong></dt>
<dd><p class="first">Name of the database.</p>
<ul class="last simple">
<li><strong class="command">database: my_database</strong></li>
</ul>
</dd>
<dt><strong class="command">table: NAME</strong></dt>
<dd><p class="first">Name of the table to export.</p>
<ul class="last simple">
<li><strong class="command">table: my_table</strong></li>
</ul>
</dd>
<dt><strong class="command">file_format: TYPE</strong></dt>
<dd><p class="first">Output file format. Available formats are <code class="docutils literal"><span class="pre">tsv.gz</span></code>, <code class="docutils literal"><span class="pre">jsonl.gz</span></code>, <code class="docutils literal"><span class="pre">json.gz</span></code>, <code class="docutils literal"><span class="pre">json-line.gz</span></code>.</p>
<ul class="last simple">
<li><strong class="command">file_format: jsonl.gz</strong></li>
</ul>
</dd>
<dt><strong class="command">from: yyyy-MM-dd HH:mm:ss[ Z]</strong></dt>
<dd><p class="first">Export records from this time (inclusive). Actual time range is <strong class="command">[from, to)</strong>. Value should be a UNIX timestamp integer (seconds) or string in yyyy-MM-dd HH:mm:ss[ Z] format.</p>
<ul class="last simple">
<li><strong class="command">from: 2016-01-01 00:00:00 +0800</strong></li>
</ul>
</dd>
<dt><strong class="command">to: yyyy-MM-dd HH:mm:ss[ Z]</strong></dt>
<dd><p class="first">Export records to this time (exclusive). Actual time range is <strong class="command">[from, to)</strong>. Value should be a UNIX timestamp integer (seconds) or string in yyyy-MM-dd HH:mm:ss[ Z] format.</p>
<ul class="last simple">
<li><strong class="command">to: 2016-02-01 00:00:00 +0800</strong></li>
</ul>
</dd>
<dt><strong class="command">s3_bucket: NAME</strong></dt>
<dd><p class="first">S3 bucket name to export records to.</p>
<ul class="last simple">
<li><strong class="command">s3_bucket: my_backup_backet</strong></li>
</ul>
</dd>
<dt><strong class="command">s3_path_prefix: NAME</strong></dt>
<dd><p class="first">S3 file name prefix.</p>
<ul class="last simple">
<li><strong class="command">s3_path_prefix: mytable/mydb</strong></li>
</ul>
</dd>
<dt><strong class="command">endpoint: ADDRESS</strong></dt>
<dd>API endpoint (default: api.treasuredata.com).</dd>
<dt><strong class="command">use_ssl: BOOLEAN</strong></dt>
<dd>Enable SSL (https) to access to the endpoint (default: true).</dd>
</dl>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id60">Output parameters</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">td.last_job_id</strong></dt>
<dd><p class="first">The job id this task executed.</p>
<ul class="last simple">
<li><strong class="command">52036074</strong></li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="pg-postgresql-operations">
<h2><a class="toc-backref" href="#id61">pg&gt;: PostgreSQL operations</a><a class="headerlink" href="#pg-postgresql-operations" title="Permalink to this headline">¶</a></h2>
<p><strong>pg&gt;</strong> operator runs queries and/or DDLs on PostgreSQL</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">pg</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.0.2.1</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5430</span>
    <span class="l l-Scalar l-Scalar-Plain">database</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">production_db</span>
    <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">app_user</span>
    <span class="l l-Scalar l-Scalar-Plain">ssl</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="l l-Scalar l-Scalar-Plain">+replace_deduplicated_master_table</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">pg&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/dedup_master_table.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">create_table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dedup_master</span>

<span class="l l-Scalar l-Scalar-Plain">+prepare_summary_table</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">pg&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/create_summary_table_ddl.sql</span>

<span class="l l-Scalar l-Scalar-Plain">+insert_to_summary_table</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">pg&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/join_log_with_master.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">insert_into</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">summary_table</span>
</pre></div>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id62">Secrets</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">pg.password: NAME</strong></dt>
<dd>Optional user password to use when connecting to the postgres database (default: empty)</dd>
</dl>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id63">Parameters</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">pg&gt;: FILE.sql</strong></dt>
<dd><p class="first">Path of the query template file. This file can contain <code class="docutils literal"><span class="pre">${...}</span></code> syntax to embed variables.</p>
<ul class="last simple">
<li><strong class="command">pg&gt;: queries/complex_queries.sql</strong></li>
</ul>
</dd>
<dt><strong class="command">create_table: NAME</strong></dt>
<dd><p class="first">Table name to create from the results. This option deletes the table if it already exists.</p>
<p>This option adds DROP TABLE IF EXISTS; CREATE TABLE AS before the statements written in the query template file. Also, CREATE TABLE statement can be written in the query template file itself without this command.</p>
<ul class="last simple">
<li><strong class="command">create_table: dest_table</strong></li>
</ul>
</dd>
<dt><strong class="command">insert_into: NAME</strong></dt>
<dd><p class="first">Table name to append results into.</p>
<p>This option adds INSERT INTO before the statements written in the query template file. Also, INSERT INTO statement can be written in the query template file itself without this command.</p>
<ul class="last simple">
<li><strong class="command">insert_into: dest_table</strong></li>
</ul>
</dd>
<dt><strong class="command">download_file: NAME</strong></dt>
<dd><p class="first">Local CSV file name to be downloaded. The file includes the result of query.</p>
<ul class="last simple">
<li><strong class="command">download_file: output.csv</strong></li>
</ul>
</dd>
<dt><strong class="command">database: NAME</strong></dt>
<dd><p class="first">Database name.</p>
<ul class="last simple">
<li><strong class="command">database: my_db</strong></li>
</ul>
</dd>
<dt><strong class="command">host: NAME</strong></dt>
<dd><p class="first">Hostname or IP address of the database.</p>
<ul class="last simple">
<li><strong class="command">host: db.foobar.com</strong></li>
</ul>
</dd>
<dt><strong class="command">port: NUMBER</strong></dt>
<dd><p class="first">Port number to connect to the database (default: 5432).</p>
<ul class="last simple">
<li><strong class="command">port: 2345</strong></li>
</ul>
</dd>
<dt><strong class="command">user: NAME</strong></dt>
<dd><p class="first">User to connect to the database</p>
<ul class="last simple">
<li><strong class="command">user: app_user</strong></li>
</ul>
</dd>
<dt><strong class="command">ssl: BOOLEAN</strong></dt>
<dd><p class="first">Enable SSL to connect to the database (default: false).</p>
<ul class="last simple">
<li><strong class="command">ssl: true</strong></li>
</ul>
</dd>
<dt><strong class="command">schema: NAME</strong></dt>
<dd><p class="first">Default schema name (default: public)</p>
<ul class="last simple">
<li><strong class="command">schema: my_schema</strong></li>
</ul>
</dd>
</dl>
<p>TODO: Add some other commands</p>
</div>
</div>
<div class="section" id="mail-sending-email">
<h2><a class="toc-backref" href="#id64">mail&gt;: Sending email</a><a class="headerlink" href="#mail-sending-email" title="Permalink to this headline">¶</a></h2>
<p><strong>mail&gt;:</strong> operator sends an email.</p>
<p>To use Gmail SMTP server, you need to do either of:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>Generate a new app password at <a class="reference external" href="https://security.google.com/settings/security/apppasswords">App passwords</a>. This needs to enable 2-Step Verification first.</li>
<li>Enable access for less secure apps at <a class="reference external" href="https://www.google.com/settings/security/lesssecureapps">Less secure apps</a>. This works even if 2-Step Verification is not enabled.</li>
</ol>
</div></blockquote>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">mail</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span> <span class="s">&quot;you@gmail.com&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">mail&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">body.txt</span>
  <span class="l l-Scalar l-Scalar-Plain">subject</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">workflow started</span>
  <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">me@example.com</span><span class="p p-Indicator">]</span>

<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">mail&gt;</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">data</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this is email body embedded in a .dig file</span>
  <span class="l l-Scalar l-Scalar-Plain">subject</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">workflow started</span>
  <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">me@example.com</span><span class="p p-Indicator">]</span>

<span class="l l-Scalar l-Scalar-Plain">+step3</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">sh&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this_task_might_fail.sh</span>
  <span class="l l-Scalar l-Scalar-Plain">_error</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">mail&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">body.txt</span>
    <span class="l l-Scalar l-Scalar-Plain">subject</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this workflow failed</span>
    <span class="l l-Scalar l-Scalar-Plain">to</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">me@example.com</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<div class="section" id="id14">
<h3><a class="toc-backref" href="#id65">Secrets</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">mail.host: HOST</strong></dt>
<dd><p class="first">SMTP host name.</p>
<ul class="last simple">
<li><strong class="command">mail.host: smtp.gmail.com</strong></li>
</ul>
</dd>
<dt><strong class="command">mail.port: PORT</strong></dt>
<dd><p class="first">SMTP port number.</p>
<ul class="last simple">
<li><strong class="command">mail.port: 587</strong></li>
</ul>
</dd>
<dt><strong class="command">mail.username: NAME</strong></dt>
<dd><p class="first">SMTP login username.</p>
<ul class="last simple">
<li><strong class="command">mail.username: me</strong></li>
</ul>
</dd>
<dt><strong class="command">mail.password: PASSWORD</strong></dt>
<dd><p class="first">SMTP login password.</p>
<ul class="last simple">
<li><strong class="command">mail.password: MyPaSsWoRd</strong></li>
</ul>
</dd>
<dt><strong class="command">mail.tls: BOOLEAN</strong></dt>
<dd><p class="first">Enables TLS handshake.</p>
<ul class="last simple">
<li><strong class="command">mail.tls: true</strong></li>
</ul>
</dd>
<dt><strong class="command">mail.ssl: BOOLEAN</strong></dt>
<dd><p class="first">Enables legacy SSL encryption.</p>
<ul class="last simple">
<li><strong class="command">mail.ssl: false</strong></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id66">Parameters</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">mail&gt;: FILE</strong></dt>
<dd><p class="first">Path to a mail body template file. This file can contain <code class="docutils literal"><span class="pre">${...}</span></code> syntax to embed variables.
Alternatively, you can set <code class="docutils literal"><span class="pre">{data:</span> <span class="pre">TEXT}</span></code> to embed body text in the .dig file.</p>
<ul class="last simple">
<li><strong class="command">mail&gt;: mail_body.txt</strong></li>
<li>or <strong class="command">mail&gt;: {body: Hello, this is from Digdag}</strong></li>
</ul>
</dd>
<dt><strong class="command">subject: SUBJECT</strong></dt>
<dd><p class="first">Subject of the email.</p>
<ul class="last simple">
<li><strong class="command">subject: Mail From Digdag</strong></li>
</ul>
</dd>
<dt><strong class="command">to: [ADDR1, ADDR2, ...]</strong></dt>
<dd><p class="first">To addresses.</p>
<ul class="last simple">
<li><strong class="command">to: [analyst&#64;examile.com]</strong></li>
</ul>
</dd>
<dt><strong class="command">from: ADDR</strong></dt>
<dd><p class="first">From address.</p>
<ul class="last simple">
<li><strong class="command">from: admin&#64;example.com</strong></li>
</ul>
</dd>
<dt><strong class="command">host: NAME</strong></dt>
<dd><p class="first">SMTP host name.</p>
<ul class="last simple">
<li><strong class="command">host: smtp.gmail.com</strong></li>
</ul>
</dd>
<dt><strong class="command">port: NAME</strong></dt>
<dd><p class="first">SMTP port number.</p>
<ul class="last simple">
<li><strong class="command">port: 587</strong></li>
</ul>
</dd>
<dt><strong class="command">username: NAME</strong></dt>
<dd><p class="first">SMTP login username.</p>
<ul class="last simple">
<li><strong class="command">username: me</strong></li>
</ul>
</dd>
<dt><strong class="command">tls: BOOLEAN</strong></dt>
<dd><p class="first">Enables TLS handshake.</p>
<ul class="last simple">
<li><strong class="command">tls: true</strong></li>
</ul>
</dd>
<dt><strong class="command">ssl: BOOLEAN</strong></dt>
<dd><p class="first">Enables legacy SSL encryption.</p>
<ul class="last simple">
<li><strong class="command">ssl: false</strong></li>
</ul>
</dd>
<dt><strong class="command">html: BOOLEAN</strong></dt>
<dd><p class="first">Uses HTML mail (default: false).</p>
<ul class="last simple">
<li><strong class="command">html: true</strong></li>
</ul>
</dd>
<dt><strong class="command">debug: BOOLEAN</strong></dt>
<dd><p class="first">Shows debug logs (default: false).</p>
<ul class="last simple">
<li><strong class="command">debug: false</strong></li>
</ul>
</dd>
<dt><strong class="command">attach_files: ARRAY</strong></dt>
<dd><p class="first">Attach files. Each element is an object of:</p>
<ul class="simple">
<li><strong class="command">path: FILE</strong>: Path to a file to attach.</li>
<li><strong class="command">content_type</strong>: Content-Type of this file. Default is application/octet-stream.</li>
<li><strong class="command">filename</strong>: Name of this file. Default is base name of the path.</li>
</ul>
<p>Example:</p>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">attach_files</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">data.csv</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">output.dat</span>
    <span class="l l-Scalar l-Scalar-Plain">filename</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">workflow_result_data.csv</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">images/image1.png</span>
    <span class="l l-Scalar l-Scalar-Plain">content_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">image/png</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="embulk-embulk-data-transfer">
<h2><a class="toc-backref" href="#id67">embulk&gt;: Embulk data transfer</a><a class="headerlink" href="#embulk-embulk-data-transfer" title="Permalink to this headline">¶</a></h2>
<p><strong>embulk&gt;:</strong> operator runs <a class="reference external" href="http://www.embulk.org">Embulk</a> to transfer data across storages including local files.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+load</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">embulk&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">data/load.yml</span>
</pre></div>
</div>
<dl class="docutils">
<dt><strong class="command">embulk&gt;: FILE.yml</strong></dt>
<dd><p class="first">Path to a configuration template file.</p>
<ul class="last simple">
<li><strong class="command">embulk&gt;: embulk/mysql_to_csv.yml</strong></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="s3-wait-wait-for-a-file-in-amazon-s3">
<h2><a class="toc-backref" href="#id68">s3_wait&gt;: Wait for a file in Amazon S3</a><a class="headerlink" href="#s3-wait-wait-for-a-file-in-amazon-s3" title="Permalink to this headline">¶</a></h2>
<p>The <strong>s3_wait&gt;:</strong> operator waits for file to appear in Amazon S3.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">+wait</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">s3_wait&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bucket/my-key</span>
</pre></div>
</div>
<div class="section" id="id16">
<h3><a class="toc-backref" href="#id69">Secrets</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">aws.s3.access-key-id, aws.access-key-id</strong></dt>
<dd>The AWS Access Key ID to use when accessing S3.</dd>
<dt><strong class="command">aws.s3.secret-access-key, aws.secret-access-key</strong></dt>
<dd>The AWS Secret Access Key to use when accessing S3.</dd>
<dt><strong class="command">aws.s3.region, aws.region</strong></dt>
<dd>An optional explicit AWS Region in which to access S3.</dd>
<dt><strong class="command">aws.s3.endpoint</strong></dt>
<dd>An optional explicit API endpoint to use when accessing S3. This overrides the <cite>region</cite> secret.</dd>
<dt><strong class="command">aws.s3.sse-c-key</strong></dt>
<dd>An optional Customer-Provided Server-Side Encryption (SSE-C) key to use when accessing S3. Must be Base64 encoded.</dd>
<dt><strong class="command">aws.s3.sse-c-key-algorithm</strong></dt>
<dd>An optional Customer-Provided Server-Side Encryption (SSE-C) key algorithm to use when accessing S3.</dd>
<dt><strong class="command">aws.s3.sse-c-key-md5</strong></dt>
<dd>An optional MD5 digest of the Customer-Provided Server-Side Encryption (SSE-C) key to use when accessing S3. Must be Base64 encoded.</dd>
</dl>
<p>For more information about SSE-C, See the <a class="reference external" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html">AWS S3 Documentation</a>.</p>
</div>
<div class="section" id="id17">
<h3><a class="toc-backref" href="#id70">Parameters</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">s3_wait&gt;: BUCKET/KEY</strong></dt>
<dd><p class="first">Path to the file in Amazon S3 to wait for.</p>
<ul class="last simple">
<li><strong class="command">s3_wait&gt;: my-bucket/my-data.gz</strong></li>
<li><strong class="command">s3_wait&gt;: my-bucket/file/in/a/directory</strong></li>
</ul>
</dd>
<dt><strong class="command">region: REGION</strong></dt>
<dd>An optional explicit AWS Region in which to access S3. This may also be specified using the <cite>aws.s3.region</cite> secret.</dd>
<dt><strong class="command">endpoint: ENDPOINT</strong></dt>
<dd>An optional explicit AWS Region in which to access S3. This may also be specified using the <cite>aws.s3.endpoint</cite> secret.
<em>Note:</em> This will override the <cite>region</cite> parameter.</dd>
<dt><strong class="command">bucket: BUCKET</strong></dt>
<dd>The S3 bucket where the file is located. Can be used together with the <cite>key</cite> parameter instead of putting the path on the operator line.</dd>
<dt><strong class="command">key: KEY</strong></dt>
<dd>The S3 key of the file. Can be used together with the <cite>bucket</cite> parameter instead of putting the path on the operator line.</dd>
<dt><strong class="command">version_id: VERSION_ID</strong></dt>
<dd>An optional object version to check for.</dd>
<dt><strong class="command">path_style_access: true/false</strong></dt>
<dd>An optional flag to control whether to use path-style or virtual hosted-style access when accessing S3.
<em>Note:</em> Enabling <cite>path_style_access</cite> also requires specifying a <cite>region</cite>.</dd>
</dl>
</div>
<div class="section" id="id18">
<h3><a class="toc-backref" href="#id71">Output Parameters</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">s3.last_object</strong></dt>
<dd><p class="first">Information about the detected file.</p>
<blockquote class="last">
<div><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
  <span class="s">&quot;metadata&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
    <span class="s">&quot;Accept-Ranges&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;bytes&quot;</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;Access-Control-Allow-Origin&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;*&quot;</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;Content-Length&quot;</span><span class="p p-Indicator">:</span> <span class="nv">4711</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;Content-Type&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;application/octet-stream&quot;</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;ETag&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;5eb63bbbe01eeed093cb22bb8f5acdc3&quot;</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;Last-Modified&quot;</span><span class="p p-Indicator">:</span> <span class="nv">1474360744000</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;Last-Ranges&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;bytes&quot;</span>
  <span class="p p-Indicator">},</span>
  <span class="s">&quot;user_metadata&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
    <span class="s">&quot;foo&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;bar&quot;</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;baz&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;quux&quot;</span>
  <span class="p p-Indicator">}</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
</div></blockquote>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>s3_wait&gt;:</strong> operator makes use of polling with <em>exponential backoff</em>.</p>
</div>
<p>As such there might be some time interval between a file being created and the <strong>s3_wait&gt;:</strong> operator detecting it.</p>
</div>
</div>
<div class="section" id="bq-running-google-bigquery-queries">
<h2><a class="toc-backref" href="#id72">bq&gt;: Running Google BigQuery queries</a><a class="headerlink" href="#bq-running-google-bigquery-queries" title="Permalink to this headline">¶</a></h2>
<p>The <strong>bq&gt;:</strong> operator can be used to run a query on Google BigQuery.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">dataset</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_dataset</span>

<span class="l l-Scalar l-Scalar-Plain">+step1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/step1.sql</span>
<span class="l l-Scalar l-Scalar-Plain">+step2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/step2.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">destination_table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result_table</span>
<span class="l l-Scalar l-Scalar-Plain">+step3</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">td&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/step3.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">destination_table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other_project:other_dataset.other_table</span>
</pre></div>
</div>
<div class="section" id="id19">
<h3><a class="toc-backref" href="#id73">Secrets</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<dl class="docutils" id="gcp-credential">
<dt><strong class="command">gcp.credential: CREDENTIAL</strong></dt>
<dd><p class="first">The <a class="reference external" href="https://cloud.google.com/docs/authentication#user_accounts_and_service_accounts">Google Cloud Platform account</a> credential private key to use, in JSON format.</p>
<p>For information on how to generate a service account key, see the <a class="reference external" href="https://cloud.google.com/storage/docs/authentication#generating-a-private-key">Google Cloud Platform Documentation</a>.</p>
<p>Upload the private key JSON file to the digdag server using the <code class="docutils literal"><span class="pre">secrets</span></code> client command:</p>
<div class="last highlight-none"><div class="highlight"><pre><span></span>digdag secrets --project my_project --set gcp.credential=@my-svc-account-b4df00d.json
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id20">
<h3><a class="toc-backref" href="#id74">Parameters</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">bq&gt;: query.sql</strong></dt>
<dd><p class="first">Path to a query template file. This file can contain <code class="docutils literal"><span class="pre">${...}</span></code> syntax to embed variables.</p>
<ul class="last simple">
<li><strong class="command">bq&gt;: queries/step1.sql</strong></li>
</ul>
</dd>
<dt><strong class="command">dataset: NAME</strong></dt>
<dd><p class="first">Specifies the default dataset to use in the query and in the <code class="docutils literal"><span class="pre">destination_table</span></code> parameter.</p>
<ul class="last simple">
<li><strong class="command">dataset: my_dataset</strong></li>
<li><strong class="command">dataset: other_project:other_dataset</strong></li>
</ul>
</dd>
<dt><strong class="command">destination_table: NAME</strong></dt>
<dd><p class="first">Specifies a table to store the query results in.</p>
<ul class="last simple">
<li><strong class="command">destination_table: my_result_table</strong></li>
<li><strong class="command">destination_table: some_dataset.some_table</strong></li>
<li><strong class="command">destination_table: some_project:some_dataset.some_table</strong></li>
</ul>
</dd>
<dt><strong class="command">create_disposition: CREATE_IF_NEEDED | CREATE_NEVER</strong></dt>
<dd><p class="first">Specifies whether the destination table should be automatically created when executing the query.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CREATE_IF_NEEDED</span></code>: <em>(default)</em> The destination table is created if it does not already exist.</li>
<li><code class="docutils literal"><span class="pre">CREATE_NEVER</span></code>: The destination table must already exist, otherwise the query will fail.</li>
</ul>
<p>Examples:</p>
<ul class="last simple">
<li><strong class="command">create_disposition: CREATE_IF_NEEDED</strong></li>
<li><strong class="command">create_disposition: CREATE_NEVER</strong></li>
</ul>
</dd>
<dt><strong class="command">write_disposition: WRITE_TRUNCATE | WRITE_APPEND | WRITE_EMPTY</strong></dt>
<dd><p class="first">Specifies whether to permit writing of data to an already existing destination table.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">WRITE_TRUNCATE</span></code>: If the destination table already exists, any data in it will be overwritten.</li>
<li><code class="docutils literal"><span class="pre">WRITE_APPEND</span></code>: If the destination table already exists, any data in it will be appended to.</li>
<li><code class="docutils literal"><span class="pre">WRITE_EMPTY</span></code>: <em>(default)</em> The query fails if the destination table already exists and is not empty.</li>
</ul>
<p>Examples:</p>
<ul class="last simple">
<li><strong class="command">write_disposition: WRITE_TRUNCATE</strong></li>
<li><strong class="command">write_disposition: WRITE_APPEND</strong></li>
<li><strong class="command">write_disposition: WRITE_EMPTY</strong></li>
</ul>
</dd>
<dt><strong class="command">priority: INTERACTIVE | BATCH</strong></dt>
<dd>Specifies the priority to use for this query. <em>Default</em>: <code class="docutils literal"><span class="pre">INTERACTIVE</span></code>.</dd>
<dt><strong class="command">use_query_cache: BOOLEAN</strong></dt>
<dd>Whether to use BigQuery query result caching. <em>Default</em>: <code class="docutils literal"><span class="pre">true</span></code>.</dd>
<dt><strong class="command">allow_large_results: BOOLEAN</strong></dt>
<dd>Whether to allow arbitrarily large result tables. Requires <code class="docutils literal"><span class="pre">destination_table</span></code> to be set and <code class="docutils literal"><span class="pre">use_legacy_sql</span></code> to be true.</dd>
<dt><strong class="command">flatten_results: BOOLEAN</strong></dt>
<dd>Whether to flatten nested and repeated fields in the query results. <em>Default</em>: <code class="docutils literal"><span class="pre">true</span></code>. Requires <code class="docutils literal"><span class="pre">use_legacy_sql</span></code> to be true.</dd>
<dt><strong class="command">use_legacy_sql: BOOLEAN</strong></dt>
<dd>Whether to use legacy BigQuery SQL. <em>Default</em>: <code class="docutils literal"><span class="pre">false</span></code>.</dd>
<dt><strong class="command">maximum_billing_tier: INTEGER</strong></dt>
<dd>Limit the billing tier for this query. <em>Default</em>: The project default.</dd>
<dt><strong class="command">table_definitions: OBJECT</strong></dt>
<dd>Describes external data sources that are accessed in the query. For more information see <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/v2/jobs#configuration.query.tableDefinitions">BigQuery documentation</a>.</dd>
<dt><strong class="command">user_defined_function_resources: LIST</strong></dt>
<dd>Describes user-defined function resources used in the query. For more information see <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/v2/jobs#configuration.query.userDefinedFunctionResources">BigQuery documentation</a>.</dd>
</dl>
</div>
<div class="section" id="id22">
<h3><a class="toc-backref" href="#id75">Output parameters</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">bq.last_job_id</strong></dt>
<dd>The id of the BigQuery job that executed this query.</dd>
</dl>
</div>
</div>
<div class="section" id="bq-ddl-managing-google-bigquery-datasets-and-tables">
<h2><a class="toc-backref" href="#id76">bq_ddl&gt;: Managing Google BigQuery Datasets and Tables</a><a class="headerlink" href="#bq-ddl-managing-google-bigquery-datasets-and-tables" title="Permalink to this headline">¶</a></h2>
<p>The <strong>bq_ddl&gt;:</strong> operator can be used to create, delete and clear Google BigQuery Datasets and Tables.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">dataset</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_dataset</span>

<span class="l l-Scalar l-Scalar-Plain">+prepare</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq_ddl&gt;</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">create_datasets</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_dataset_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">empty_datasets</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_dataset_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">delete_datasets</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_dataset_${last_session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">create_tables</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_table_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">empty_tables</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_table_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">delete_tables</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_table_${last_session_date_compact}</span>
</pre></div>
</div>
<div class="section" id="id23">
<h3><a class="toc-backref" href="#id77">Secrets</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">gcp.credential: CREDENTIAL</strong></dt>
<dd>See <a class="reference internal" href="#gcp-credential">gcp_credential</a>.</dd>
</dl>
</div>
<div class="section" id="id24">
<h3><a class="toc-backref" href="#id78">Parameters</a><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">create_datasets: LIST</strong></dt>
<dd><p class="first">Create new datasets.</p>
<p>For detailed information about dataset configuration parameters, see the <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/v2/datasets#resource">Google BigQuery Datasets Documentation</a>.</p>
<p>Examples:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">create_datasets</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_project:bar</span>
</pre></div>
</div>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">create_datasets</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo_dataset_${session_date_compact}</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar_dataset_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">project</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other_project</span>
    <span class="l l-Scalar l-Scalar-Plain">friendly_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset ${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset for ${session_date}</span>
    <span class="l l-Scalar l-Scalar-Plain">default_table_expiration</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7d</span>
    <span class="l l-Scalar l-Scalar-Plain">location</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">EU</span>
    <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="l l-Scalar l-Scalar-Plain">quux</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">17</span>
    <span class="l l-Scalar l-Scalar-Plain">access</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">domain</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">READER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">userByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ingest@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">WRITER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">groupByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">administrators@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OWNER</span>
</pre></div>
</div>
</dd>
<dt><strong class="command">empty_datasets: LIST</strong></dt>
<dd><p class="first">Create new datasets, deleting them first if they already exist. Any tables in the datasets will also be deleted.</p>
<p>For detailed information about dataset configuration parameters, see the <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/v2/datasets#resource">Google BigQuery Datasets Documentation</a>.</p>
<p>Examples:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">empty_datasets</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_project:bar</span>
</pre></div>
</div>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">empty_datasets</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo_dataset_${session_date_compact}</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar_dataset_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">project</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other_project</span>
    <span class="l l-Scalar l-Scalar-Plain">friendly_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset ${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset for ${session_date}</span>
    <span class="l l-Scalar l-Scalar-Plain">default_table_expiration</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7d</span>
    <span class="l l-Scalar l-Scalar-Plain">location</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">EU</span>
    <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="l l-Scalar l-Scalar-Plain">quux</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">17</span>
    <span class="l l-Scalar l-Scalar-Plain">access</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">domain</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">READER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">userByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ingest@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">WRITER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">groupByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">administrators@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OWNER</span>
</pre></div>
</div>
</dd>
<dt><strong class="command">delete_datasets: LIST</strong></dt>
<dd><p class="first">Delete datasets, if they exist.</p>
<p>Examples:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">delete_datasets</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_project:bar</span>
</pre></div>
</div>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">delete_datasets</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo_dataset_${last_session_date_compact}</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_project:bar_dataset_${last_session_date_compact}</span>
</pre></div>
</div>
</dd>
<dt><strong class="command">create_tables: LIST</strong></dt>
<dd><p class="first">Create new tables.</p>
<p>For detailed information about table configuration parameters, see the <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/v2/tables#resource">Google BigQuery Tables Documentation</a>.</p>
<p>Examples:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">create_tables</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_dataset.bar</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_project:yet_another_dataset.baz</span>
</pre></div>
</div>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">create_tables</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo_dataset_${session_date_compact}</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar_dataset_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">project</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other_project</span>
    <span class="l l-Scalar l-Scalar-Plain">dataset</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other_dataset</span>
    <span class="l l-Scalar l-Scalar-Plain">friendly_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset ${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset for ${session_date}</span>
    <span class="l l-Scalar l-Scalar-Plain">expiration_time</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2016-11-01-T01:02:03Z</span>
    <span class="l l-Scalar l-Scalar-Plain">schema</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">foo</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">STRING</span><span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">bar</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">INTEGER</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="l l-Scalar l-Scalar-Plain">quux</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">17</span>
    <span class="l l-Scalar l-Scalar-Plain">access</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">domain</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">READER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">userByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ingest@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">WRITER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">groupByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">administrators@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OWNER</span>
</pre></div>
</div>
</dd>
<dt><strong class="command">empty_tables: LIST</strong></dt>
<dd><p class="first">Create new tables, deleting them first if they already exist.</p>
<p>For detailed information about table configuration parameters, see the <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/v2/tables#resource">Google BigQuery Tables Documentation</a>.</p>
<p>Examples:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">empty_tables</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_dataset.bar</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_project:yet_another_dataset.baz</span>
</pre></div>
</div>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">empty_tables</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo_table_${session_date_compact}</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar_table_${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">project</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other_project</span>
    <span class="l l-Scalar l-Scalar-Plain">dataset</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other_dataset</span>
    <span class="l l-Scalar l-Scalar-Plain">friendly_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset ${session_date_compact}</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bar dataset for ${session_date}</span>
    <span class="l l-Scalar l-Scalar-Plain">expiration_time</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2016-11-01-T01:02:03Z</span>
    <span class="l l-Scalar l-Scalar-Plain">schema</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">foo</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">STRING</span><span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">bar</span><span class="p p-Indicator">,</span> <span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">INTEGER</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">foo</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
      <span class="l l-Scalar l-Scalar-Plain">quux</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">17</span>
    <span class="l l-Scalar l-Scalar-Plain">access</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">domain</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">READER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">userByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ingest@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">WRITER</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">groupByEmail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">administrators@example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">OWNER</span>
</pre></div>
</div>
</dd>
<dt><strong class="command">delete_tables: LIST</strong></dt>
<dd><p class="first">Delete tables, if they exist.</p>
<p>Examples:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">delete_tables</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_dataset.bar</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">other_project:yet_another_dataset.baz</span>
</pre></div>
</div>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">delete_tables</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo_table_${last_session_date_compact}</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bar_table_${last_session_date_compact}</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="bq-extract-exporting-data-from-google-bigquery">
<h2><a class="toc-backref" href="#id79">bq_extract&gt;: Exporting Data from Google BigQuery</a><a class="headerlink" href="#bq-extract-exporting-data-from-google-bigquery" title="Permalink to this headline">¶</a></h2>
<p>The <strong>bq_extract&gt;:</strong> operator can be used to export data from Google BigQuery tables.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">dataset</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_dataset</span>

<span class="l l-Scalar l-Scalar-Plain">+process</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/analyze.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">destination_table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>

<span class="l l-Scalar l-Scalar-Plain">+export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq_extract&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="l l-Scalar l-Scalar-Plain">destination</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gs://my_bucket/result.csv.gz</span>
  <span class="l l-Scalar l-Scalar-Plain">compression</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">GZIP</span>
</pre></div>
</div>
<div class="section" id="id27">
<h3><a class="toc-backref" href="#id80">Secrets</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">gcp.credential: CREDENTIAL</strong></dt>
<dd>See <a class="reference internal" href="#gcp-credential">gcp_credential</a>.</dd>
</dl>
</div>
<div class="section" id="id28">
<h3><a class="toc-backref" href="#id81">Parameters</a><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">bq_extract&gt;: TABLE</strong></dt>
<dd><p class="first">A reference to the table that should be exported.</p>
<ul class="last simple">
<li><strong class="command">bq_extract&gt;: my_table</strong></li>
<li><strong class="command">bq_extract&gt;: my_dataset.my_table</strong></li>
<li><strong class="command">bq_extract&gt;: my_project:my_dataset.my_table</strong></li>
</ul>
</dd>
<dt><strong class="command">destination: URI | LIST</strong></dt>
<dd><p class="first">A URI or list of URIs with the location of the destination export files. These must be Google Cloud Storage URIs.</p>
<p>Examples:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>destination&gt;: gs://my_bucket/my_export.csv
</pre></div>
</div>
<div class="last highlight-none"><div class="highlight"><pre><span></span>destination&gt;:
  - gs://my_bucket/my_export_1.csv
  - gs://my_bucket/my_export_2.csv
</pre></div>
</div>
</dd>
<dt><strong class="command">print_header: BOOLEAN</strong></dt>
<dd>Whether to print out a header row in the results. <em>Default</em>: <code class="docutils literal"><span class="pre">true</span></code>.</dd>
<dt><strong class="command">field_delimiter: CHARACTER</strong></dt>
<dd><p class="first">A delimiter to use between fields in the output. <em>Default</em>: <code class="docutils literal"><span class="pre">,</span></code>.</p>
<ul class="last simple">
<li><strong class="command">field_delimiter: '\t'</strong></li>
</ul>
</dd>
<dt><strong class="command">destination_format: CSV | NEWLINE_DELIMITED_JSON | AVRO</strong></dt>
<dd><p class="first">The format of the destination export file. <em>Default</em>: <code class="docutils literal"><span class="pre">CSV</span></code>.</p>
<ul class="last simple">
<li><strong class="command">destination_format: CSV</strong></li>
<li><strong class="command">destination_format: NEWLINE_DELIMITED_JSON</strong></li>
<li><strong class="command">destination_format: AVRO</strong></li>
</ul>
</dd>
<dt><strong class="command">compression: GZIP | NONE</strong></dt>
<dd><p class="first">The compression to use for the export file. <em>Default</em>: <code class="docutils literal"><span class="pre">NONE</span></code>.</p>
<ul class="last simple">
<li><strong class="command">compression: NONE</strong></li>
<li><strong class="command">compression: GZIP</strong></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="id29">
<h3><a class="toc-backref" href="#id82">Output parameters</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">bq.last_job_id</strong></dt>
<dd>The id of the BigQuery job that performed this export.</dd>
</dl>
</div>
</div>
<div class="section" id="bq-load-importing-data-into-google-bigquery">
<h2><a class="toc-backref" href="#id83">bq_load&gt;: Importing Data into Google BigQuery</a><a class="headerlink" href="#bq-load-importing-data-into-google-bigquery" title="Permalink to this headline">¶</a></h2>
<p>The <strong>bq_load&gt;:</strong> operator can be used to import data into Google BigQuery tables.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">_export</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">dataset</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_dataset</span>

<span class="l l-Scalar l-Scalar-Plain">+ingest</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq_load&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gs://my_bucket/data.csv</span>
  <span class="l l-Scalar l-Scalar-Plain">destination_table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_data</span>

<span class="l l-Scalar l-Scalar-Plain">+process</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">bq&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">queries/process.sql</span>
  <span class="l l-Scalar l-Scalar-Plain">destination_table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my_result</span>
</pre></div>
</div>
<div class="section" id="id30">
<h3><a class="toc-backref" href="#id84">Secrets</a><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">gcp.credential: CREDENTIAL</strong></dt>
<dd>See <a class="reference internal" href="#gcp-credential">gcp_credential</a>.</dd>
</dl>
</div>
<div class="section" id="id31">
<h3><a class="toc-backref" href="#id85">Parameters</a><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">bq_load&gt;: URI | LIST</strong></dt>
<dd><p class="first">A URI or list of URIs identifying files in GCS to import.</p>
<p>Examples:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">bq_load&gt;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gs://my_bucket/data.csv</span>
</pre></div>
</div>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">bq_load&gt;</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">gs://my_bucket/data1.csv.gz</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">gs://my_bucket/data2_*.csv.gz</span>
</pre></div>
</div>
</dd>
<dt><strong class="command">dataset: NAME</strong></dt>
<dd><p class="first">The dataset that the destination table is located in or should be created in. Can also be specified directly in the table reference.</p>
<ul class="last simple">
<li><strong class="command">dataset&gt;: my_dataset</strong></li>
<li><strong class="command">dataset&gt;: my_project:my_dataset</strong></li>
</ul>
</dd>
<dt><strong class="command">destination_table: NAME</strong></dt>
<dd><p class="first">The table to store the imported data in.</p>
<ul class="last simple">
<li><strong class="command">destination_table: my_result_table</strong></li>
<li><strong class="command">destination_table: some_dataset.some_table</strong></li>
<li><strong class="command">destination_table: some_project:some_dataset.some_table</strong></li>
</ul>
</dd>
<dt><strong class="command">project: NAME</strong></dt>
<dd>The project that the table is located in or should be created in. Can also be specified directly in the table reference or the dataset parameter.</dd>
<dt><strong class="command">source_format: CSV | NEWLINE_DELIMITED_JSON | AVRO | DATASTORE_BACKUP</strong></dt>
<dd><p class="first">The format of the files to be imported. <em>Default</em>: <code class="docutils literal"><span class="pre">CSV</span></code>.</p>
<ul class="last simple">
<li><strong class="command">source_format: CSV</strong></li>
<li><strong class="command">source_format: NEWLINE_DELIMITED_JSON</strong></li>
<li><strong class="command">source_format: AVRO</strong></li>
<li><strong class="command">source_format: DATASTORE_BACKUP</strong></li>
</ul>
</dd>
<dt><strong class="command">field_delimiter: CHARACTER</strong></dt>
<dd><p class="first">The separator used between fields in CSV files to be imported. <em>Default</em>: <code class="docutils literal"><span class="pre">,</span></code>.</p>
<ul class="last simple">
<li><strong class="command">field_delimiter: '\t'</strong></li>
</ul>
</dd>
<dt><strong class="command">create_disposition: CREATE_IF_NEEDED | CREATE_NEVER</strong></dt>
<dd><p class="first">Specifies whether the destination table should be automatically created when performing the import.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CREATE_IF_NEEDED</span></code>: <em>(default)</em> The destination table is created if it does not already exist.</li>
<li><code class="docutils literal"><span class="pre">CREATE_NEVER</span></code>: The destination table must already exist, otherwise the import will fail.</li>
</ul>
<p>Examples:</p>
<ul class="last simple">
<li><strong class="command">create_disposition: CREATE_IF_NEEDED</strong></li>
<li><strong class="command">create_disposition: CREATE_NEVER</strong></li>
</ul>
</dd>
<dt><strong class="command">write_disposition: WRITE_TRUNCATE | WRITE_APPEND | WRITE_EMPTY</strong></dt>
<dd><p class="first">Specifies whether to permit importing data to an already existing destination table.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">WRITE_TRUNCATE</span></code>: If the destination table already exists, any data in it will be overwritten.</li>
<li><code class="docutils literal"><span class="pre">WRITE_APPEND</span></code>: If the destination table already exists, any data in it will be appended to.</li>
<li><code class="docutils literal"><span class="pre">WRITE_EMPTY</span></code>: <em>(default)</em> The import fails if the destination table already exists and is not empty.</li>
</ul>
<p>Examples:</p>
<ul class="last simple">
<li><strong class="command">write_disposition: WRITE_TRUNCATE</strong></li>
<li><strong class="command">write_disposition: WRITE_APPEND</strong></li>
<li><strong class="command">write_disposition: WRITE_EMPTY</strong></li>
</ul>
</dd>
<dt><strong class="command">skip_leading_rows: INTEGER</strong></dt>
<dd><p class="first">The number of leading rows to skip in CSV files to import. <em>Default</em>: <code class="docutils literal"><span class="pre">0</span></code>.</p>
<ul class="last simple">
<li><strong class="command">skip_leading_rows: 1</strong></li>
</ul>
</dd>
<dt><strong class="command">encoding: UTF-8 | ISO-8859-1</strong></dt>
<dd><p class="first">The character encoding of the data in the files to import. <em>Default</em>: <code class="docutils literal"><span class="pre">UTF-8</span></code>.</p>
<ul class="last simple">
<li><strong class="command">encoding: ISO-8859-1</strong></li>
</ul>
</dd>
<dt><strong class="command">quote: CHARACTER</strong></dt>
<dd><p class="first">The character quote of the data in the files to import. <em>Default</em>: <code class="docutils literal"><span class="pre">'&quot;'</span></code>.</p>
<ul class="last simple">
<li><strong class="command">quote: ''</strong></li>
<li><strong class="command">quote: &quot;'&quot;</strong></li>
</ul>
</dd>
<dt><strong class="command">max_bad_records: INTEGER</strong></dt>
<dd><p class="first">The maximum number of bad records to ignore before failing the import. <em>Default</em>: <code class="docutils literal"><span class="pre">0</span></code>.</p>
<ul class="last simple">
<li><strong class="command">max_bad_records: 100</strong></li>
</ul>
</dd>
<dt><strong class="command">allow_quoted_newlines: BOOLEAN</strong></dt>
<dd>Whether to allow quoted data sections that contain newline characters in a CSV file. <em>Default</em>: <code class="docutils literal"><span class="pre">false</span></code>.</dd>
<dt><strong class="command">allow_jagged_rows: BOOLEAN</strong></dt>
<dd>Whether to accept rows that are missing trailing optional columns in CSV files. <em>Default</em>: <code class="docutils literal"><span class="pre">false</span></code>.</dd>
<dt><strong class="command">ignore_unknown_values: BOOLEAN</strong></dt>
<dd>Whether to ignore extra values in data that are not represented in the table schema. <em>Default</em>: <code class="docutils literal"><span class="pre">false</span></code>.</dd>
<dt><strong class="command">projection_fields: LIST</strong></dt>
<dd>A list of names of Cloud Datastore entity properties to load. Requires <code class="docutils literal"><span class="pre">source_format:</span> <span class="pre">DATASTORE_BACKUP</span></code>.</dd>
<dt><strong class="command">autodetect: BOOLEAN</strong></dt>
<dd>Whether to automatically infer options and schema for CSV and JSON sources. <em>Default</em>: <code class="docutils literal"><span class="pre">false</span></code>.</dd>
<dt><strong class="command">schema_update_options: LIST</strong></dt>
<dd><p class="first">A list of destination table schema updates that may be automatically performed when performing the import.</p>
<div class="last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">schema_update_options</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ALLOW_FIELD_ADDITION</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ALLOW_FIELD_RELAXATION</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id32">
<h3><a class="toc-backref" href="#id86">Output parameters</a><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong class="command">bq.last_job_id</strong></dt>
<dd>The id of the BigQuery job that performed this import.</dd>
</dl>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="command_reference.html" class="btn btn-neutral float-right" title="Command reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scheduling_workflow.html" class="btn btn-neutral" title="Scheduling workflow" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, 2016, Digdag Project.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>