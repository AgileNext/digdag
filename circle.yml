machine:
  timezone: UTC
  java:
    version: oraclejdk8

dependencies:
  override:
    - mkdir -p ~/bin/
    - curl -u beta:workflow2016 -o ~/bin/digdag -L "https://dl.digdag.io/digdag-latest"
    - chmod +x ~/bin/digdag

test:
  override:
    - digdag check

  post:
    - digdag push digdag-ci-poc -e api-workflow.treasuredata.com -X client.http.headers.authorization="TD1 $TD_API_KEY" -r `date -u +"%Y-%m-%dT%H:%M:%SZ"`-`git rev-parse HEAD`
    - digdag start digdag-ci-poc workflow --session "2014-10-04 00:00:00" -e api-workflow.treasuredata.com -X client.http.headers.authorization="TD1 $TD_API_KEY"
