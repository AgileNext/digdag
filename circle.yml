machine:
  timezone: UTC

dependencies:
  override:
    - sudo apt-get -y update
    - sudo apt-get -y install software-properties-common apt-transport-https wget
    - sudo add-apt-repository -y ppa:webupd8team/java
    - echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections
    - sudo apt-get -y update
    - sudo apt-get -y install oracle-java8-installer
    - sudo apt-get -y install oracle-java8-set-default
    - mkdir -p ~/bin/
    - curl -u beta:workflow2016 -o ~/bin/digdag -L "https://dl.digdag.io/digdag-latest"
    - chmod +x ~/bin/digdag

test:
  override:
    - digdag check

  post:
    - digdag push digdag-ci-poc -X header.authorization="TD $TD_API_KEY" -r `date -u +"%Y-%m-%dT%H:%M:%SZ"`-`git rev-parse HEAD`
